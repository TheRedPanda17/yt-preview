<% content_for(:title) { "My Votes - YT Preview" } %>

<div class="min-h-screen bg-[#f1f1f1]" style="font-family: 'Roboto', Arial, sans-serif;">
  <!-- Header bar -->
  <div class="bg-white border-b border-[#e5e5e5] sticky top-0 z-40">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 h-14 flex items-center justify-between">
      <div class="flex items-center gap-3">
        <svg class="w-7 h-7 text-red-600" viewBox="0 0 24 24" fill="currentColor">
          <path d="M23.498 6.186a3.016 3.016 0 0 0-2.122-2.136C19.505 3.545 12 3.545 12 3.545s-7.505 0-9.377.505A3.017 3.017 0 0 0 .502 6.186C0 8.07 0 12 0 12s0 3.93.502 5.814a3.016 3.016 0 0 0 2.122 2.136c1.871.505 9.376.505 9.376.505s7.505 0 9.377-.505a3.015 3.015 0 0 0 2.122-2.136C24 15.93 24 12 24 12s0-3.93-.502-5.814zM9.545 15.568V8.432L15.818 12l-6.273 3.568z"/>
        </svg>
        <span class="text-base font-medium text-[#0f0f0f]">My Votes</span>
      </div>
      <div class="flex items-center gap-2 px-3 py-1.5 rounded-full border border-[#e5e5e5] bg-[#f1f1f1]">
        <div class="w-7 h-7 rounded-full bg-purple-600 flex items-center justify-center text-white text-xs font-medium">
          <%= voter_name[0].upcase %>
        </div>
        <span class="text-sm font-medium text-[#0f0f0f]"><%= voter_name %></span>
      </div>
    </div>
  </div>

  <div class="max-w-7xl mx-auto px-4 sm:px-6 py-6">
    <div class="mb-8">
      <h1 class="text-2xl font-bold text-[#0f0f0f] mb-1">Your voting history</h1>
      <p class="text-sm text-[#606060]">All the videos you've been invited to vote on.</p>
    </div>

    <% if @video_shares.any? %>
      <div class="space-y-4">
        <% @video_shares.each do |video_share| %>
          <% video = video_share.video %>
          <% admin = video.admin_user %>
          <% first_pair = video.variants.first&.title_thumbnail_pairs&.first %>
          <% progress = @voting_progress[video.id] %>

          <a href="<%= preview_path(video.share_token, video_share.token) %>"
             class="flex items-center gap-3 bg-white rounded-xl border border-[#e5e5e5] hover:shadow-md transition-shadow p-4 sm:p-5">
            <!-- Thumbnail preview -->
            <div class="flex-shrink-0 relative rounded-lg overflow-hidden bg-[#e5e5e5]" style="width: 100px; height: 56px;">
              <% if first_pair&.has_thumbnail? %>
                <% if first_pair.thumbnail.attached? %>
                  <%= image_tag first_pair.thumbnail, class: "absolute inset-0 w-full h-full object-cover", loading: "lazy", style: "width:100px;height:56px;" %>
                <% else %>
                  <img src="<%= first_pair.thumbnail_url %>" class="absolute inset-0 w-full h-full object-cover" alt="" loading="lazy" style="width:100px;height:56px;">
                <% end %>
              <% else %>
                <div class="w-full h-full flex items-center justify-center text-[#909090]">
                  <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
                    <path d="M21 3H3c-1.11 0-2 .89-2 2v14c0 1.11.89 2 2 2h18c1.11 0 2-.89 2-2V5c0-1.11-.89-2-2-2zm0 16H3V5h18v14zM9.5 13l2.5 3.01L14.5 12l4.5 6H5l4.5-6z"/>
                  </svg>
                </div>
              <% end %>
              <% if video.video_duration.present? %>
                <span class="absolute bottom-1 right-1 bg-black/80 text-white font-medium px-1 rounded z-10" style="font-size: 9px; line-height: 14px; letter-spacing: 0.5px;"><%= video.video_duration %></span>
              <% end %>
            </div>

            <!-- Video info -->
            <div class="flex-1 min-w-0">
              <h2 class="text-[#0f0f0f] font-medium text-base line-clamp-1"><%= video.working_title %></h2>
              <p class="text-[#606060] text-sm"><%= admin.yt_username %></p>
            </div>

            <!-- Status badges -->
            <div class="flex items-center gap-2.5 flex-shrink-0">
              <% if video.ended? %>
                <span class="inline-flex items-center gap-1 text-xs font-medium px-2.5 py-1 rounded-full bg-gray-100 text-[#606060]">Ended</span>
              <% else %>
                <span class="inline-flex items-center gap-1 text-xs font-medium px-2.5 py-1 rounded-full bg-blue-50 text-[#065fd4]">Open</span>
              <% end %>
              <% if progress == :completed %>
                <span class="inline-flex items-center gap-1 text-xs font-medium px-2.5 py-1 rounded-full bg-green-50 text-green-700">
                  <svg class="w-3 h-3" viewBox="0 0 24 24" fill="currentColor"><path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/></svg>
                  Done
                </span>
              <% elsif progress == :in_progress %>
                <span class="inline-flex items-center gap-1 text-xs font-medium px-2.5 py-1 rounded-full bg-yellow-50 text-yellow-700">In progress</span>
              <% else %>
                <span class="inline-flex items-center gap-1 text-xs font-medium px-2.5 py-1 rounded-full bg-gray-50 text-[#909090]">Not started</span>
              <% end %>
            </div>

            <!-- Arrow -->
            <div class="flex-shrink-0 text-[#909090]">
              <svg class="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path stroke-linecap="round" stroke-linejoin="round" d="M9 5l7 7-7 7"/>
              </svg>
            </div>
          </a>
        <% end %>
      </div>
    <% else %>
      <div class="text-center py-20 bg-white rounded-xl border border-[#e5e5e5]">
        <svg class="w-16 h-16 mx-auto text-[#e5e5e5] mb-4" fill="currentColor" viewBox="0 0 24 24">
          <path d="M21 3H3c-1.11 0-2 .89-2 2v14c0 1.11.89 2 2 2h18c1.11 0 2-.89 2-2V5c0-1.11-.89-2-2-2zm0 16H3V5h18v14zM9.5 13l2.5 3.01L14.5 12l4.5 6H5l4.5-6z"/>
        </svg>
        <p class="text-[#606060] text-base">No videos to vote on yet.</p>
        <p class="text-[#909090] text-sm mt-1">When a creator shares a video with you, it will show up here.</p>
      </div>
    <% end %>
  </div>
</div>
